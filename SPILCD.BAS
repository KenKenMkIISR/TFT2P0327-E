REM SPI-LCD TFT2P0327-E
REM CS:D9 RST:B0

USEVAR VERT
VERT=0:REM Horizontal Mode
SPI 8000
GOSUB LCDINI
GOSUB LCDCLR
GOSUB MARU,80,64,50,$FFFF

END

LABEL MARU
 VAR X,Y,R,C,P,Q,F
 X=ARGS(1):Y=ARGS(2):R=ARGS(3):C=ARGS(4)
 P=R:Q=0:F=-2*R+3
 WHILE P>=Q
  GOSUB LCDDOT,X-P,Y-Q,C:GOSUB LCDDOT,X+P,Y-Q,C
  GOSUB LCDDOT,X-P,Y+Q,C:GOSUB LCDDOT,X+P,Y+Q,C
  GOSUB LCDDOT,X-Q,Y-P,C:GOSUB LCDDOT,X+Q,Y-P,C
  GOSUB LCDDOT,X-Q,Y+P,C:GOSUB LCDDOT,X+Q,Y+P,C
  IF F>=0 THEN P=P-1:F=F-P*4
  Q=Q+1:F=F+Q*4+2
 WEND
RETURN

LABEL LCDDOT
 REM Set LCD Pixel Color
 GOSUB LCDXY,ARGS(1),ARGS(2)
 GOSUB LCDWRT,$22,ARGS(3)
RETURN

LABEL LCDXY
 REM SET LCD Cursor Position
 IF VERT THEN
  GOSUB LCDWRT,$21,(ARGS(2)<<8)+ARGS(1)
 ELSE
  GOSUB LCDWRT,$21,(ARGS(1)<<8)+ARGS(2)
 ENDIF
RETURN

LABEL LCDCLR
 REM Clear LCD
 GOSUB LCDXY,0,0
 GOSUB LCDIDX,$22
 FOR I=1 TO 20480:GOSUB LCDDAT,0:NEXT 
RETURN

LABEL LCDINI
 REM LCD Initialize
 OUT 0,0:WAIT 2:OUT 0,1:WAIT 1
 GOSUB LCDWRT,$0007,$0020
 GOSUB LCDWRT,$00B6,$013F
 GOSUB LCDWRT,$00B4,$0010
 GOSUB LCDWRT,$0012,$00B2
 GOSUB LCDWRT,$0013,$080E
 GOSUB LCDWRT,$0014,$5BCA
 GOSUB LCDWRT,$0061,$0018
 GOSUB LCDWRT,$0010,$190C

 WAIT 5

 GOSUB LCDWRT,$0013,$081E

 WAIT 2

 GOSUB LCDWRT,$0002,$0100

 IF VERT THEN
  REM In case of Vertical
  GOSUB LCDWRT,$0001,$0014
  GOSUB LCDWRT,$0003,$0030
 ELSE
  REM In case of Horizontal
  GOSUB LCDWRT,$0001,$0114
  GOSUB LCDWRT,$0003,$0028
 ENDIF

 GOSUB LCDWRT,$0008,$0202
 GOSUB LCDWRT,$000B,$0000
 GOSUB LCDWRT,$000C,$0000
 GOSUB LCDWRT,$0061,$0018
 GOSUB LCDWRT,$0069,$0000
 GOSUB LCDWRT,$0070,$0000
 GOSUB LCDWRT,$0071,$0000
 GOSUB LCDWRT,$0011,$0000

 GOSUB LCDWRT,$0030,$0303
 GOSUB LCDWRT,$0031,$0303
 GOSUB LCDWRT,$0032,$0303
 GOSUB LCDWRT,$0033,$0000
 GOSUB LCDWRT,$0034,$0404
 GOSUB LCDWRT,$0035,$0404
 GOSUB LCDWRT,$0036,$0404
 GOSUB LCDWRT,$0037,$0000
 GOSUB LCDWRT,$0038,$0707

 GOSUB LCDWRT,$0040,$0000
 GOSUB LCDWRT,$0042,$9F00
 GOSUB LCDWRT,$0043,$0000
 GOSUB LCDWRT,$0044,$7F00
 GOSUB LCDWRT,$0045,$9F00
 GOSUB LCDWRT,$0069,$0000
 GOSUB LCDWRT,$0070,$0000
 GOSUB LCDWRT,$0071,$0000
 GOSUB LCDWRT,$0073,$0000
 GOSUB LCDWRT,$00B3,$0000
 GOSUB LCDWRT,$00BD,$0000
 GOSUB LCDWRT,$00BE,$0000
 GOSUB LCDWRT,$0021,$0000

 WAIT 2

 GOSUB LCDWRT,$0007,$0020

 WAIT 2

 GOSUB LCDWRT,$0007,$0021
 GOSUB LCDWRT,$0007,$0027

 WAIT 4

 GOSUB LCDWRT,$0007,$0037
RETURN

LABEL LCDWRT
 GOSUB LCDIDX,ARGS(1)
 GOSUB LCDDAT,ARGS(2)
RETURN

LABEL LCDIDX
 SPIWRITE $70,ARGS(1)>>8,ARGS(1) AND $FF
RETURN

LABEL LCDDAT
 SPIWRITE $72,ARGS(1)>>8,ARGS(1) AND $FF
RETURN
